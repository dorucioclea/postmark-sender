language: go
sudo: required
go:
- 1.12.x
dist: trusty
addons:
  sonarcloud:
    organization: paysuper
stages:
- test
- name: deploy
  if: branch = master
jobs:
  include:
  - stage: test
    services:
    - rabbitmq
    install: true
    script:
    - go test ./... -coverprofile=coverage.out -covermode=atomic -p=1
    after_success:
    - bash <(curl -s https://codecov.io/bash)
  - stage: deploy
    services: docker
    install: true
    script:
    - docker run -it -e JENKINS_AUTH_TOKEN=$JENKINS_AUTH_TOKEN -e JENKINS_BUILD_TOKEN=$JENKINS_BUILD_TOKEN
      -e JENKINS_BUILD_PROJECT=$TRAVIS_REPO_SLUG -e JENKINS_BUILD_BRANCH=$TRAVIS_BRANCH
      p1hub/p1jenkinstrigger
notifications:
  email: false
  slack:
    secure: b0jJIiQ0QXF2T3Pr/AZ8zZtmivmSKbYaTMuRbw0F4KRNmILPtCKYUK1sIHmwYmAC0INtuLIFWSqWKyMpGdIg+v2HGWohpKpxmOQeJWgMbxxDtS5jMIHloqNtsAuyMg8ILWT4aDoMF+0Rj/t9TnML92QnYUguBzH309BAMapOO6LiBAEOf0CLFafc7Fa+bsPijqQ7JaAT9xY59qD7Qi/mZ6N5wmDzBKfUA5D+uk29elONoaLoZhJLNg9hDRYf/BkKdn3wLDFuQ7O+j9NNXcPz4MpRxQyFoGqvKHQ+2fPf/zQRWYKUlO8n5eG6ntPA7kdMF2sa/06NIJUmySzDGJlarnVSdKU/vez+fNCD+NGu4pPSLX4qqY/th3SSszhJN9/x3S2YMCJtQDLSLBnhnOX6WNsaOFsCQwx1317YZs4OiZO1/IDLbDhrwkoQfHBLTwlYrusA+g0ErFlOB8yGXyFvksiwwXZL4CMLbfJT1/jpEV+M4Y6YiHxIPpqxmhjuwcF0fN47D8TZ7xq1NG9kj8QAgwbQr9bICnWtR+2SHr5YxgW3RlqacI2e4TVbU0+/6qwU3W5BEznkwDQzxK1ds8H3GnQkxVBCfTrY/F60ask8uwqt4NLCpHEjb6FcfZZCQgTfh86Ooc2E6QqKZGkcrhOqLxy7XoJ8hjfUUsRnTdoWPko=
env:
  global:
  - GO111MODULE=on
  - secure: tDWVN3enlA5Zmk0arlMmhxWCRC8gfTycqiIhboQR9/LY3H3i5l85J4HG4josJNIQCFeqAIbR66f1PMBdzKuSVIdziGNfH600wUiQEsVYWvtZK8UKa2jFEid/egDreK4vJ5Csv85u/zxw47FEAYvHClkVpGzlCxTogyLK7bbkx5xW15M342pwNDO8fD4ybXKdxwiyzDGNGTa2fEPUM43xWxuHr+i2RxPqZ8GwjZ6LzBrxVSYCXZPpsxlsvjZhDS67w82xxWdvFbqULinB8jayV47XvADlEqMwGkqpBsK817o94yQ8jd8xrgj2V7G+bd5dkHbo1GAELn8kB53sd4hpxEMAWgERQV3iShAV2FK3TjtQLBacDjjUlE2ncHu/05K8ceeUZ6PAhiCPVsu/QAl8xmtSTVCtaZvLLLszxXnTA9Km56FPL1Z6yXmZzt4+xdwgiP/L1TGEsVM9/JkXIFxW98hPjQDkFBACJisAWphOWwwkPSDJI9X9lItu98JyklAJWCqrfyrbFqTM+RE2Df3+heEasXyXKuFDZAqGjgcs0j8R52XJAbf0J2a50VGvQAX2VgfEU+Ku958DSvuSPAnnkaTuq0yzSihNh1eGA8K/O1AK4YxtuVCWvidafEvDTPuuFyP7vrG2hgkNJ5WKnRSaJJwAcyULhtFwmCZ3WizceqM=
  - secure: FRnbMiwp5EVLN5eBOC7cUjDxNqukalQLhUjaEH3RFMhUbmstJLjjcEtWGfKY4LbsqTcwX9WBNRJ+8825eex1vdtMqnfMsaZ3NY058L0sl2KPkqEaUI1IeMwy9zp2tRByUYqoLQzfXGZElHfKoa+iEx5U/b7CdLW3YvriUmEeQcSpaDE6sYy8wai6D4+6nT/kEc1Ogg6U/czlqzgpown81+igvLedgSCTQbCD5FealM+egdTf7StHaggKfO2KBkI28RoZCTeb8edYArQWm3AkzP6Drqtz7aVT+at2pAGCGuxBj0KNvma/mvZdR4A96BLq8toeyRayEjtH8tDTZffLzkm4/CTESAvQl6ziZXo0OGrGDz8MkAmkqtv4yKA+ZC2/IG4Daka5Cj+6mgkh8ASKo43CKBoB2YnImLtPH723neu0wtDn9Gy/nE8p73cmZiOOw5pb953xPoXHZDaHHg4+FXnYIvxGRGWz8e/jo1pnND2HAwRgxPcbO9NjKDbe1S960ZOkwnUFYsIudQzzXJ0t/gUP21eu1jstiW/zUjF94z/JqyYibUbud50HiVKzzUD+mRph0iriue4COwn0mzLtspe9WB1zuLRYdmXgHIJGAEliR7SdQkna3cBZelpormxUALZFnhvqdttESuJ3uT6iPnsFYLu0ubS/1X9KRpslCuM=
  - secure: vfobTBO8kk6DQQYApapjjeMRcqI7PVn8t6pFxVCUy4MgJOKUS9dBZSyrouC0b9yPRRuOKQ21gTSx7ck+4YaWP7j1kGO/kjT+ZcxU7q3/fF82aDH1ISRHXBNT/1gHz1hBQLrIzDkCppy2Xl4mZnRZEd4X5YChXyl1u4xDobmEj7sutL01JeM2KA95T8zAdMM2ZxjefWhtJJ0kwCWdbv0vt3s2sW0lnt1JN/hlpeiD1iVaQZ+ceBMIdgJRGMgP5+gIspA3OqCKLqV/oZrkDY3QHPuNAIYakMpsCmimErEfEAKaicPHELVX7W9tJvuZDBS/jy7iX5+VxUouNbK3UdK5FpjsWhgpRdXo/Tjt/vXm0rEAiVaKdXFUHKvAkL07a8YIUmmzEA6lbi6TmCbLOY7ACbQclQRsvHBH39EBJkCb+wpXFGb7fumKW+XuNit3EIoAwqczrooVa40Rvunhid3KUQsBeyY+UbxGTE6KD52iUkv0UlKNKYHHpSSrNuzkO6wQN5BegHsoqOJwS4haN5MB4V5WNRw307HSvM0otDUZH4vqRyzjhpRW2ao9IU4sv98kOX9Jo+Yp/iyncFYT3Paqb1xz9ICVZQKkF1MsA1EaQy6umw4lDuzEjwD7X2oTV8i0g3gk/dePifzbPaBaXP58Uy9Q94vMelKrNFEhbJ7QCps=
